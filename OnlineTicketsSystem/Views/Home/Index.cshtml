@model OnlineTicketsSystem.ViewModels.HomeIndexVm
@using OnlineTicketsSystem.Helpers

@section Styles {
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
}
@{
    ViewData["HideMainNav"] = true;
}

<div class="home">
    <section class="hero">
        <div class="hero__overlay"></div>

        <div class="container hero__content">
            @* <div class="hero__top">
                <div class="brand">
                    <div class="brand__icon">🎟️</div>
                    <div class="brand__name">Билети Онлайн</div>
                </div>
                <nav class="hero__nav">
                    <a class="btn btn-ghost btn-sm" asp-controller="Home" asp-action="Index">Начало</a>
                    <a class="btn btn-ghost btn-sm" asp-controller="Events" asp-action="Index">Събития</a>
                    <a class="btn btn-ghost btn-sm" asp-controller="Cities" asp-action="Index">Градове</a>
                    <a class="btn btn-ghost btn-sm" asp-controller="Cart" asp-action="Index">Кошница</a>
                </nav>

                <div class="hero__auth">
                    @if (User.Identity != null && User.Identity.IsAuthenticated)
                    {
                        <a class="btn btn-ghost btn-sm" asp-controller="Tickets" asp-action="My">Моите билети</a>
                        <a class="btn btn-ghost btn-sm" asp-controller="Cart" asp-action="Index">Кошница</a>
                        <a class="btn btn-ghost btn-sm" asp-area="Identity" asp-page="/Account/Manage/Index">Профил</a>
                        <form asp-area="Identity" asp-page="/Account/Logout" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-primary btn-sm">Изход</button>
                        </form>
                    }
                    else
                    {
                        <a class="btn btn-ghost btn-sm" asp-area="Identity" asp-page="/Account/Login">Вход</a>
                        <a class="btn btn-primary btn-sm" asp-area="Identity" asp-page="/Account/Register">Регистрация</a>
                    }
                </div>
            </div> *@
            <div class="hero__top">
                <a class="brand" asp-controller="Home" asp-action="Index">
                    <span class="brand__icon">🎟️</span>
                    <span class="brand__name">TicketNest</span>
                </a>

                <nav class="hero__nav">
                    <a class="navlink" asp-controller="Home" asp-action="Index">Начало</a>
                    <a class="navlink" asp-controller="Events" asp-action="Index">Събития</a>
                    <a class="navlink" asp-controller="Cities" asp-action="Index">Градове</a>
                    <a class="navlink" asp-controller="Cart" asp-action="Index">Кошница</a>
                    <a class="navlink" asp-controller="Tickets" asp-action="My">Моите билети</a>
                </nav>

                <div class="hero__auth">
                    @if (User.Identity != null && User.Identity.IsAuthenticated)
                    {
                        <a class="btn btn-ghost btn-sm" asp-area="Identity" asp-page="/Account/Manage/Index">Профил</a>
                        <form asp-area="Identity" asp-page="/Account/Logout" method="post" class="d-inline">
                            <button type="submit" class="btn btn-primary btn-sm">Изход</button>
                        </form>
                    }
                    else
                    {
                        <a class="btn btn-ghost btn-sm" asp-area="Identity" asp-page="/Account/Login">Вход</a>
                        <a class="btn btn-primary btn-sm" asp-area="Identity" asp-page="/Account/Register">Регистрация</a>
                    }
                </div>
            </div>


            <div class="hero__grid">
                <div class="hero__left">
                    <h1 class="hero__title">Открий и резервирай<br />следващото си събитие</h1>

                    <p class="hero__subtitle">
                        Намерете най-добрите концерти, театрални постановки, фестивали и спортни събития близо до вас.
                    </p>

                    <a class="btn btn-primary btn-lg" asp-controller="Events" asp-action="Index">Разгледай събития</a>

                    <div class="upcoming">
                        <div class="upcoming__header">
                            <h2 class="section-title">Предстоящи събития</h2>
                        </div>
                        <form method="get" class="filters">
                            <!-- Категории -->
                            <select name="category" class="filter">
                                <option value="">Всички категории</option>
                                @foreach (var cat in Model.Categories)
                                {
                                    <option value="@cat">@cat</option>
                                }
                            </select>

                            <!-- Градове с търсачка -->
                            <input class="filter"
                                   name="city"
                                   list="citiesList"
                                   placeholder="Търси град…" />

                            <datalist id="citiesList">
                                @foreach (var c in Model.Cities)
                                {
                                    <option value="@c"></option>
                                }
                            </datalist>

                            <!-- Дати -->
                            <select name="dateMode" class="filter">
                                <option value="">Предстоящи дати</option>
                                <option value="thisWeek">Тази седмица</option>
                                <option value="thisMonth">Този месец</option>
                                <option value="nextMonth">Следващ месец</option>
                            </select>

                            <!-- Цена -->
                            <select name="priceRange" class="filter">
                                <option value="">Ценови диапазон</option>
                                <option value="0-5">0–5 EUR</option>
                                <option value="5-10">5–10 EUR</option>
                                <option value="10-15">10–15 EUR</option>
                                <option value="15-20">15–20 EUR</option>
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm filter-btn">
                                Търси
                            </button>

                        </form>
                       

                        <div class="cards">
                            @foreach (var e in Model.UpcomingEvents)
                            {
                                var img = string.IsNullOrWhiteSpace(e.ImageUrl) ? "/images/placeholder.jpg" : e.ImageUrl;
                                var cat = e.Category?.Name ?? "Събитие";

                                <div class="event-card">
                                    <div class="event-card__img" style="background-image:url('@img');"></div>

                                    <div class="event-card__body">
                                        <div class="pill">
                                            <span>🏷️</span> @cat
                                        </div>

                                        <h3 class="event-card__title">@e.Title</h3>

                                        <div class="meta">
                                            <div class="meta__row">📅 @e.Date.ToString("dd.MM.yyyy")</div>
                                            <div class="meta__row">📍 @e.City, @e.Venue</div>
                                            <div class="meta__row">💶 @e.Price.ToString("0.00") EUR</div>
                                        </div>

                                        <a class="btn btn-primary btn-sm"
                                           asp-controller="Events"
                                           asp-action="Details"
                                           asp-route-id="@e.Id">
                                            Виж
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <div class="hero__right">
                    <!-- оставяме празно/за бъдещо: може да сложим mini banner или статистика -->
                </div>
            </div>
        </div>
    </section>

    <section class="why">
        <div class="container">
            <h2 class="script-title">Защо да избереш Билети Онлайн?</h2>

            <div class="why__grid">
                <div class="why__item">
                    <div class="why__icon">🎫</div>
                    <div class="why__text">
                        <h3>Голям избор</h3>
                        <p>Открий разнообразие от събития – от концерти до спорт и фестивали.</p>
                    </div>
                </div>

                <div class="why__item">
                    <div class="why__icon">🔒</div>
                    <div class="why__text">
                        <h3>Сигурни резервации</h3>
                        <p>Добавяш в кошница, плащаш (симулация) и виждаш билетите си в „Моите билети“.</p>
                    </div>
                </div>

                <div class="why__item">
                    <div class="why__icon">💬</div>
                    <div class="why__text">
                        <h3>Лесно и бързо</h3>
                        <p>Интуитивен процес: избери → детайли → количество → кошница → плати.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cities">
        <div class="container">
            <h2 class="section-title">Популярни градове за събития</h2>

            <div class="cities__grid">
                @foreach (var city in Model.Cities)
                {
                    if (CitySlugMap.TryGetSlug(city, out var slug))
                    {
                        var cityImg = "/images/cities/default.jpg"; // можеш после да сложиш реални снимки

                        <a class="city" asp-controller="Cities" asp-action="ByCity" asp-route-slug="@slug">
                            <div class="city__img" style="background-image:url('@cityImg');"></div>
                            <div class="city__name">@city</div>
                        </a>
                    }
                }
            </div>
        </div>
        

    </section>
</div>
